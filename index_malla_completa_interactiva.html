<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Curricular Fonoaudiolog铆a</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fef6ff;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      color: #a64ca6;
      margin-bottom: 2rem;
    }
    .semestre {
      background: #f7e6ff;
      padding: 1rem;
      border-radius: 1rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .semestre h2 {
      color: #6a1b9a;
      border-bottom: 2px solid #ce93d8;
      margin-bottom: 1rem;
    }
    .materia {
      background: linear-gradient(135deg, #e1bee7, #f8bbd0);
      margin: 0.5rem 0;
      padding: 0.75rem 1rem;
      border-radius: 0.8rem;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      position: relative;
    }
    .materia:hover {
      transform: scale(1.02);
    }
    .materia.aprobada {
      text-decoration: line-through;
      background: #b3e5fc;
      color: #333;
      opacity: 0.6;
    }
    .materia.bloqueada {
      background: #f0f0f0;
      color: #aaa;
      text-decoration: line-through;
      cursor: not-allowed;
    }
    .tooltip {
      visibility: hidden;
      background-color: #616161;
      color: #fff;
      text-align: center;
      padding: 5px;
      border-radius: 6px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.75rem;
    }
    .materia:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
    .contador {
      font-weight: bold;
      margin-top: 1rem;
      color: #7b1fa2;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular Fonoaudiolog铆a</h1>
  <div id="contenedor"></div>

  <script>
    const materias = [
      { codigo: 'ing_b1', nombre: 'Suficiencia en Ingl茅s B1 (Requisito)', semestre: 0 },
      // Semestre 1
      { codigo: 's1_m1', nombre: 'Fundamentos Fonoaudiol贸gicos', semestre: 1 },
      { codigo: 's1_m2', nombre: 'Anatom铆a y Fisiolog铆a General', semestre: 1 },
      { codigo: 's1_m3', nombre: 'Psicolog铆a del Desarrollo', semestre: 1 },
      { codigo: 's1_m4', nombre: 'Contexto Social y Salud Colectiva', semestre: 1 },
      { codigo: 's1_m5', nombre: 'Lenguaje y Comunicolog铆a', semestre: 1 },
      { codigo: 's1_m6', nombre: 'Biog茅nica', semestre: 1 },

      // Semestre 2
      { codigo: 's2_m1', nombre: 'Anatom铆a de Cabeza, Cuello y T贸rax', semestre: 2, prerequisitos: ['s1_m2'] },
      { codigo: 's2_m2', nombre: 'Psicopatolog铆a', semestre: 2, prerequisitos: ['s1_m3'] },
      { codigo: 's2_m3', nombre: 'F铆sica de la Audici贸n', semestre: 2, prerequisitos: ['s1_m2'] },
      { codigo: 's2_m4', nombre: 'Herramientas de la Investigaci贸n', semestre: 2 },
      { codigo: 's2_m5', nombre: 'Fon茅tica y Fonolog铆a Espa帽ola', semestre: 2, correquisitos: ['s2_m7'] },
      { codigo: 's2_m6', nombre: 'Crecimiento y Desarrollo', semestre: 2, prerequisitos: ['s1_m2'], correquisitos: ['s2_m7'] },
      { codigo: 's2_m7', nombre: 'Lenguaje y Cognici贸n', semestre: 2, prerequisitos: ['s1_m5'], correquisitos: ['s2_m5', 's2_m6'] },

      // Semestre 3
      { codigo: 's3_m1', nombre: 'Alto Riesgo Infantil', semestre: 3, prerequisitos: ['s2_m6'], correquisitos: ['s3_m6'] },
      { codigo: 's3_m2', nombre: 'Psicomotricidad', semestre: 3, prerequisitos: ['s2_m6'], correquisitos: ['s3_m4'] },
      { codigo: 's3_m3', nombre: 'Diagn贸stico Fonoaudiol贸gico y Programaci贸n Terap茅utica', semestre: 3, prerequisitos: ['s2_m7', 's2_m6'] },
      { codigo: 's3_m4', nombre: 'T茅cnica de An谩lisis y Modificaci贸n de la Conducta', semestre: 3, prerequisitos: ['s2_m6'], correquisitos: ['s3_m2'] },
      { codigo: 's3_m5', nombre: 'Otolog铆a', semestre: 3, prerequisitos: ['s2_m1', 's2_m3'] },
      { codigo: 's3_m6', nombre: 'Anatom铆a y Fisiolog铆a Neurol贸gica', semestre: 3, prerequisitos: ['s2_m1'], correquisitos: ['s3_m1'] },
      { codigo: 's3_m7', nombre: 'Bioestad铆stica', semestre: 3, prerequisitos: ['s2_m4'] },

      // Semestre 4
      { codigo: 's4_m1', nombre: 'Pr谩ctica. Evaluaci贸n Fonoaudiol贸gica Infantil', semestre: 4, prerequisitos: ['s3_m3'], correquisitos: ['s4_m2', 's4_m3'] },
      { codigo: 's4_m2', nombre: 'Neurolog铆a Infantil y del Adulto', semestre: 4, prerequisitos: ['s3_m6'], correquisitos: ['s4_m1'] },
      { codigo: 's4_m3', nombre: 'Patolog铆as del Habla, Degluci贸n y Rehabilitaci贸n', semestre: 4, prerequisitos: ['s3_m3', 's3_m6'], correquisitos: ['s4_m1'] },
      { codigo: 's4_m4', nombre: 'Audiolog铆a y Laberinolog铆a', semestre: 4, prerequisitos: ['s3_m1', 's3_m5'] },
      { codigo: 's4_m5', nombre: 'Odontoestomatolog铆a', semestre: 4 },
      { codigo: 's4_m6', nombre: 'Terap茅utica Fonoaudiol贸gica en Trastornos Cognitivos y Sensoriales', semestre: 4, prerequisitos: ['s3_m1'] },
      { codigo: 's4_m7', nombre: 'Salud P煤blica I', semestre: 4, prerequisitos: ['s3_m7'] },

      // Semestre 5
      { codigo: 's5_m1', nombre: 'Intervenci贸n Fonoaudiol贸gica I', semestre: 5, prerequisitos: ['s4_m1'], correquisitos: ['s5_m2', 's5_m3', 's5_m5'] },
      { codigo: 's5_m2', nombre: 'Patolog铆as del Lenguaje y su Rehabilitaci贸n', semestre: 5, prerequisitos: ['s4_m2', 's4_m3'], correquisitos: ['s5_m1'] },
      { codigo: 's5_m3', nombre: 'Audiolog铆a y Laberinolog铆a Patol贸gica', semestre: 5, prerequisitos: ['s4_m4', 's4_m2'], correquisitos: ['s5_m1'] },
      { codigo: 's5_m4', nombre: 'Terap茅utica en Trastornos Neuromotores', semestre: 5, prerequisitos: ['s4_m6', 's4_m2'] },
      { codigo: 's5_m5', nombre: 'Evaluaci贸n y Diagn贸stico de la Voz', semestre: 5, prerequisitos: ['s4_m2', 's4_m3'], correquisitos: ['s5_m1'] },
      { codigo: 's5_m6', nombre: 'Geriatr铆a y Gerontolog铆a', semestre: 5, prerequisitos: ['s4_m2'] },
      { codigo: 's5_m7', nombre: 'Salud P煤blica II', semestre: 5, prerequisitos: ['s4_m7'] },

      // Semestre 6
      { codigo: 's6_m1', nombre: 'Relaci贸n Cl铆nica y Terap茅utica I', semestre: 6, prerequisitos: ['s5_m1'], correquisitos: ['s6_m4'] },
      { codigo: 's6_m2', nombre: 'Terap茅utica en Malformaciones Orofaciales', semestre: 6, prerequisitos: ['s5_m5'] },
      { codigo: 's6_m3', nombre: 'Metodolog铆a de la Investigaci贸n I', semestre: 6, prerequisitos: ['s5_m7'] },
      { codigo: 's6_m4', nombre: 'Intervenci贸n Fonoaudiol贸gica II', semestre: 6, prerequisitos: ['s5_m1'], correquisitos: ['s6_m1', 's6_m5', 's6_m6'] },
      { codigo: 's6_m5', nombre: 'Terapia y Rehabilitaci贸n de la Voz', semestre: 6, prerequisitos: ['s5_m5'], correquisitos: ['s6_m4'] },
      { codigo: 's6_m6', nombre: 'Audiopr贸tesis e Intervenci贸n Auditiva', semestre: 6, prerequisitos: ['s5_m3'], correquisitos: ['s6_m4'] },

      // Semestre 7
      { codigo: 's7_m1', nombre: 'Administraci贸n Fonoaudiol贸gica', semestre: 7 },
      { codigo: 's7_m2', nombre: 'Intervenci贸n Fonoaudiol贸gica III', semestre: 7, prerequisitos: ['s6_m4'], correquisitos: ['s7_m3', 's7_m7'] },
      { codigo: 's7_m3', nombre: 'An谩lisis Ac煤stico de la Voz', semestre: 7, prerequisitos: ['s6_m5'], correquisitos: ['s7_m2'] },
      { codigo: 's7_m4', nombre: 'Metodolog铆a de la Investigaci贸n II', semestre: 7, prerequisitos: ['s6_m3'] },
      { codigo: 's7_m5', nombre: 'T茅cnicas Did谩cticas en Fonoaudiolog铆a', semestre: 7 },
      { codigo: 's7_m6', nombre: 'Trastornos del Aprendizaje', semestre: 7, prerequisitos: ['s6_m4'] },
      { codigo: 's7_m7', nombre: 'Relaci贸n Cl铆nica y Terap茅utica II', semestre: 7, prerequisitos: ['s6_m1'], correquisitos: ['s7_m2'] },

      // Semestre 8
      { codigo: 's8_m1', nombre: 'Diagn贸stico e Intervenci贸n Fonoaudiol贸gica Integral', semestre: 8, prerequisitos: ['s7_m2', 's7_m7'], correquisitos: ['s8_m2'] },
      { codigo: 's8_m2', nombre: 'Ejecuci贸n Terap茅utica Fonoaudiol贸gica', semestre: 8, prerequisitos: ['s7_m2', 's7_m7'], correquisitos: ['s8_m1'] },
      { codigo: 's8_m3', nombre: 'Integraci贸n de Proyecto I', semestre: 8, prerequisitos: ['s7_m4'] },

      // Semestre 9
      { codigo: 's9_m1', nombre: 'Promoci贸n y Prevenci贸n Fonoaudiol贸gica', semestre: 9, prerequisitos: ['s8_m1'] },
      { codigo: 's9_m2', nombre: 'Pr谩cticas en Centros de Salud II', semestre: 9, prerequisitos: ['s8_m2'] },
      { codigo: 's9_m3', nombre: 'Integraci贸n de Proyecto II', semestre: 9, prerequisitos: ['s8_m3'] }
    ];

    const estado = JSON.parse(localStorage.getItem('estadoMaterias') || '{}');

    function crearHTML() {
      const contenedor = document.getElementById('contenedor');
      contenedor.innerHTML = '';
      const maxSemestre = Math.max(...materias.map(m => m.semestre));
      for (let i = 0; i <= maxSemestre; i++) {
        const semestre = document.createElement('div');
        semestre.className = 'semestre';
        const titulo = document.createElement('h2');
        titulo.textContent = `Semestre ${i}`;
        semestre.appendChild(titulo);

        const materiasSemestre = materias
          .filter(m => m.semestre === i)
          .sort((a, b) => {
            const puedeA = puedeTomar(a);
            const puedeB = puedeTomar(b);
            if (puedeA === puedeB) return 0;
            return puedeA ? -1 : 1;
          });

        let contador = 0;

        materiasSemestre.forEach(m => {
          const div = document.createElement('div');
          div.className = 'materia';
          div.textContent = m.nombre;
          div.dataset.codigo = m.codigo;

          const tooltip = document.createElement('div');
          tooltip.className = 'tooltip';
          tooltip.innerHTML = generarTooltip(m);
          div.appendChild(tooltip);

          if (estado[m.codigo]) {
            div.classList.add('aprobada');
            contador++;
          } else if (!puedeTomar(m)) {
            div.classList.add('bloqueada');
          }

          semestre.appendChild(div);
        });

        const contadorDiv = document.createElement('div');
        contadorDiv.className = 'contador';
        contadorDiv.textContent = `${contador} materia(s) aprobada(s).`;
        semestre.appendChild(contadorDiv);

        contenedor.appendChild(semestre);
      }
    }

    function puedeTomar(materia) {
      const preOk = !materia.prerequisitos || materia.prerequisitos.every(c => estado[c]);
      const coOk = !materia.correquisitos || materia.correquisitos.every(c => estado[c]);
      const es9noSemestre = materia.semestre === 9;
      if (es9noSemestre && !estado['ing_b1']) return false;
      return preOk && coOk;
    }

    function generarTooltip(materia) {
      const prereqNombres = materia.prerequisitos?.map(cod => {
        const m = materias.find(x => x.codigo === cod);
        return m ? m.nombre : cod;
      }) || [];
      const correqNombres = materia.correquisitos?.map(cod => {
        const m = materias.find(x => x.codigo === cod);
        return m ? m.nombre : cod;
      }) || [];

      const prereq = prereqNombres.length ? ` Pre: ${prereqNombres.join(', ')}` : '';
      const coreq = correqNombres.length ? ` Co: ${correqNombres.join(', ')}` : '';
      return [prereq, coreq].filter(Boolean).join('<br>');
    }

    function toggleAprobada(div) {
      const codigo = div.dataset.codigo;
      if (div.classList.contains('bloqueada')) return;
      if (estado[codigo]) {
        delete estado[codigo];
      } else {
        estado[codigo] = true;
      }
      localStorage.setItem('estadoMaterias', JSON.stringify(estado));
      crearHTML();
    }

    document.addEventListener('click', e => {
      if (e.target.classList.contains('materia')) {
        toggleAprobada(e.target);
      }
    });

    crearHTML();
  </script>
</body>
</html>
